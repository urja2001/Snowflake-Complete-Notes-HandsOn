• To create Organization Administrator account
   1. Snowflake web UI the top right corne --> Change ACCOUNTADMIN to ORGADMIN

• Organization Administrator
------------------------------------

CREATE ORGANIZATION ACCOUNT myorgwiproaccount    -- Organization AccountName
    ADMIN_NAME = urja                   -- UserName
    ADMIN_PASSWORD = 'TestPassword123'  -- Password at first time login
    EMAIL = 'urjajain2102@gmail.com'  -- To send the notification 
    MUST_CHANGE_PASSWORD = true    -- To change the password at first time login --> TestPassword1234
    EDITION = enterprise;          -- Type of edition


 o To list accounts

show organization accounts;   -- same as show organization accounts history;  or show accounts


 o To check regions available in a account 

show regions;  


 o Delete aaccount  

drop account myorgaccount
GRACE_PERIOD_IN_DAY = 3; -- By Default 3 to 90 days


 o To rename account 

alter account myorgaccount rename to myorgwiproaccount;        -- https://hlfxyxi-myorgaccount.snowflakecomputing.com to https://hlfxyxi-myorgwiproaccount.snowflakecomputing.com

------------------------------------------------------------------------------

• Account Administrator --> By Default 
------------------------------------

 o User 1 - Account Admins 

CREATE USER Donald PASSWORD = 'abc123'
DEFAULT_ROLE = ACCOUNTADMIN 
MUST_CHANGE_PASSWORD = TRUE;           -- To change the password at first time login --> TestPassword1234

GRANT ROLE ACCOUNTADMIN TO USER Donald;


 o  User 2 - Security Admin 

CREATE USER Charles PASSWORD = 'abc123' 
DEFAULT_ROLE = SECURITYADMIN 
MUST_CHANGE_PASSWORD = TRUE;                 -- To change the password at first time login --> TestPassword1234

GRANT ROLE SECURITYADMIN TO USER Charles;


 o User 3 - Sysadmin

CREATE USER Janet PASSWORD = 'abc123' 
DEFAULT_ROLE = SYSADMIN 
MUST_CHANGE_PASSWORD = TRUE;                     -- To change the password at first time login --> TestPassword1234

GRANT ROLE SYSADMIN TO USER Janet;

------------------------------------------------------------------------------

• Security Admin
------------------------------------

- Login as user Charles who is Security Admin

-- Create roles 

CREATE ROLE sales_admin;

CREATE ROLE sales_users;


-- Create hierarchy

GRANT ROLE sales_users to ROLE sales_admin;

GRANT ROLE sales_admin to ROLE SYSADMIN;


--- Create sales user

CREATE USER Amar_sales PASSWORD = 'abc123' DEFAULT_ROLE =  sales_users 
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE sales_users TO USER Amar_sales;


-- Create user for sales admin

CREATE USER Akbar_sales_admin PASSWORD = 'abc123' DEFAULT_ROLE =  sales_admin
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE sales_admin TO USER  Akbar_sales_admin;


--  2. Create Roles & Users for HR

CREATE ROLE hr_admin;

CREATE ROLE hr_users;


-- Create hierarchy

GRANT ROLE hr_users to ROLE hr_admin;

--- This time we will not assign roles to SYSADMIN
--- Grant role hr_admin to role SYSADMIN;

--  Create hr user

CREATE USER Bobby_hr PASSWORD = 'abc123' DEFAULT_ROLE =  hr_users 
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE hr_users TO USER Bobby_hr;


-- Create user for sales admin

CREATE USER Balu_hr_admin PASSWORD = 'abc123' DEFAULT_ROLE =  hr_admin
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE hr_admin TO USER Balu_hr_admin;

------------------------------------------------------------------------------

• System Admin
------------------------------------

- Login as user Janet who is System Admin

-- Create a warehouse of size SMALL

CREATE WAREHOUSE public_wh 
WITH
WAREHOUSE_SIZE='SMALL'
AUTO_SUSPEND=300 
AUTO_RESUME= TRUE;

-- Grant usage on warehouse to role public

GRANT USAGE ON WAREHOUSE public_wh TO ROLE PUBLIC


-- Create database accessible to everyone

CREATE DATABASE public_db;

GRANT USAGE ON DATABASE public_db TO ROLE PUBLIC;


-- Create sales database

CREATE DATABASE sales_db;

-- Grant ownership to sales_admin

GRANT OWNERSHIP ON DATABASE sales_db TO ROLE sales_admin;

-- Now the owner of this database is sales_admin which is assigned to SYSADMIN

GRANT OWNERSHIP ON SCHEMA sales_db.public TO ROLE sales_admin;


-- Create hr database

CREATE DATABASE hr_db;


-- Grant ownership to hr_admin that we had created using SEC ADMIN

GRANT OWNERSHIP ON DATABASE hr_db TO ROLE hr_admin;

-- Now the owner of this database is hr_admin which is not assigned to SYSADMIN

GRANT OWNERSHIP ON SCHEMA hr_db.public TO ROLE hr_admin;

-- Try to drop hr_db - but we can't drop

DROP DATABASE hr_db;

------------------------------------------------------------------------------

• Custom Roles
------------------------------------

-- Operate with the custom roles

USE ROLE sales_admin;

USE sales_db;


-- Create a table

create or replace table customers(
  id number,
  full_name varchar, 
  email varchar,
  phone varchar,
  create_date DATE DEFAULT CURRENT_DATE);


-- Insert data in table

insert into customers (id, full_name, email,phone)
values
  (1,'abc','abc@gmail.com','262-665-9168'),
  (2,'def','def@gmail.com','734-987-7120'),
  (3,'ghi','ghi@gmail.com','867-946-3659'),
  (4,'jkl','jkl@gmail.com','563-853-8192');
  
SHOW TABLES;


-- Switch to sales_users role

USE ROLE sales_users;

SELECT* FROM CUSTOMERS;


-- Switch back to admin role and grant access

USE ROLE sales_admin;

GRANT USAGE ON DATABASE sales_db TO ROLE sales_users;

GRANT USAGE ON SCHEMA sales_db.public TO ROLE sales_users;

GRANT SELECT ON TABLE sales_db.public.CUSTOMERS TO ROLE sales_users;


-- Switch to sales_users role

USE ROLE sales_users;

SELECT* FROM CUSTOMERS;

-- Try DML operations using sales_users role

DELETE FROM CUSTOMERS;

DROP TABLE CUSTOMERS;


-- Switch back to admin role, grant delete access

USE ROLE sales_admin;

GRANT ALL ON TABLE sales_db.public.CUSTOMERS TO ROLE sales_users;


-- Switch to sales_users role

USE ROLE sales_users;

DELETE FROM CUSTOMERS;


-- You can't drop this object with All priv, only owner can drop objects

DROP TABLE CUSTOMERS;

-- Switch back to admin role and grant ownsership

USE ROLE sales_admin;

GRANT OWNERSHIP ON TABLE sales_db.public.CUSTOMERS TO ROLE sales_users;


-- Above query won't work, first we have to revoke other privileges

REVOKE ALL ON TABLE sales_db.public.CUSTOMERS FROM ROLE SALES_USERS;

GRANT OWNERSHIP ON TABLE sales_db.public.CUSTOMERS TO ROLE SALES_USERS;


-- Switch to sales_users role

USE ROLE sales_users;

DROP TABLE CUSTOMERS;

------------------------------------------------------------------------------

• User Admin
------------------------------------

- Login with SEC ADMIN and switch to USERADMIN

CREATE ROLE market_admin;

CREATE ROLE market_users;


GRANT ROLE market_users to ROLE market_admin;

GRANT ROLE market_admin to ROLE SYSADMIN;


CREATE USER bharath PASSWORD = 'abc123' DEFAULT_ROLE =  market_users 
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE market_users TO USER bharath;
